{% extends "base.html" %}

{% block title %}{{ name }}'s Profile{% endblock %}

{% block body %}

<h1 class="profile-name">{{ name }}</h1>

{% if name == username %}
<form action="/uploadsong" method="post" enctype="multipart/form-data">
    <h2>Upload a new song</h2>
    <div class="upload-form">
        <label for="song">mp3 File</label>
        <input type="file" name="song" accept=".mp3" id="file-select" required></input>
    </div>
    <div class="upload-form">
        <label for="title">Title</label>
        <input type="text" name="title" id="song-title" required></input>
    </div>
    <div class="upload-form">
        <label for="title">Description</label>
        <textarea name="description"></textarea>
    </div>
    <div class="upload-form">
        <label for="tags">Tags</label>
        <input type="text" name="tags" placeholder="country, extratone, vocals, ..."></input>
    </div>
    <div class="upload-form">
        <label for="collabs">Collaborators</label>
        <input type="text" name="collabs" placeholder="@fren_user, John Doe, ..."></input>
    </div>
    <div class="upload-form">
        <input type="submit" value="Upload"></input>
    </div>
</form>
{% endif %}

<!-- Automatically set song name from file name -->
<script>
document.getElementById("file-select").addEventListener("change", function(e) {
    var songTitle = document.getElementById("song-title");
    if (e.target.files[0] && !songTitle.value) {
        var name = e.target.files[0].name;
        songTitle.value = name.substring(0, name.length - 4);
    }
});
</script>

<h2>Songs</h2>

<!-- TODO: This is duplicated in songs-by-tag.html -->
{% for song in songs %}
<div class="song">
    <div class="song-title">{{ song["title"] }}</div>
    <audio src="/song/{{ song["userid"] }}/{{ song["songid"] }}" controls></audio>
    <div class="song-description">{{ song["description"] }}</div>
    <div class="song-tags">
        {% for tag in songs_tags[song["songid"]] %}
        <a href="/songs-by-tag/{{ tag["tag"] }}">{{ tag["tag"] }}</a>
        {% endfor %}
    </div>
    <div class="song-collabs">
        {% for collab in songs_collaborators[song["songid"]] %}
            {% if collab["name"].startswith("@") %}
            <a href="/users/{{ collab["name"][1:] }}" class="collab-link">{{ collab["name"] }}</a>
            {% else %}
            <span class="collab-name">{{ collab["name"] }}</span>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endfor %}

{% endblock %}
