{% from "song-macros.html" import song_info, song_details %}

<div class="song-list">
{% for song in songs %}
    <div class="song" data-song="{{ song.json() }}">
        <div class="song-main">
            <div class="song-list-pfp-container">
                {%- if song.user_has_pfp %}
                <!-- Profile Picture -->
                <img class="small-pfp" src="/pfp/{{ song.userid }}" onerror="this.style.display = 'none'" width="32" height="32" />
                {%- endif %}
            </div>

            {{ song_info(song) | indent(12) }}

            <div class="song-buttons">
                <!-- Details Button -->
                <button onclick="return showDetails(event)" class="song-list-button details-toggle" title="Toggle Details">
                    <img class="lsp_btn_show02" alt="Show Details">
                </button>

                <!-- Play Button -->
                <button onclick="return play(event)" class="song-list-button" title="Play">
                    <img class="lsp_btn_play02" alt="Play">
                </button>
            </div>
        </div>
        {{ song_details(song, current_user_playlists) | indent(8) }}
    </div>
{% endfor %}
</div>

<script>
function showDetails(event) {
    var songElement = event.target.closest(".song");
    var songDetails = songElement.querySelector(".song-details");
    var detailsToggle = songElement.querySelector(".details-toggle img");
    if (songDetails.hidden) {
        // Show details
        songDetails.hidden = false;
        detailsToggle.alt = "Hide Details";
        detailsToggle.className = "lsp_btn_hide02";
        detailsToggle.src = customImage(document.getElementById("lsp_btn_hide02"));
    }
    else {
        // Hide details
        songDetails.hidden = true;
        detailsToggle.alt = "Show Details";
        detailsToggle.className = "lsp_btn_show02";
        detailsToggle.src = customImage(document.getElementById("lsp_btn_show02"));
    }
    return false;
}
</script>
