<div class="song-list">
{% for song in songs %}
    <div class="song" data-song="{{ song.json() }}">
        <div class="song-main">
            <div class="song-info">
                <!-- Song Title -->
                <div class="song-title">{{ song.title }}</div>

                <!-- Separator -->
                -

                <!-- Song Artist -->
                <a href="/users/{{ song.username }}" class="song-username">{{ song.username }}</a>

                <!-- Song Collaborators -->
                <div class="song-collabs">
                    {% for collab in song.collaborators %}
                        {% if collab.startswith("@") %}
                        <a href="/users/{{ collab[1:] }}" class="collab-link">{{ collab }}</a>
                        {% else %}
                        <span class="collab-name">{{ collab }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            <div class="song-buttons">

                <!-- Owner-Specific Buttons (Edit/Delete) -->
                {% if session["userid"] == song.userid %}
                <a href="/edit-song?songid={{ song.songid }}" class="song-list-button">
                    <img src="/static/lsp_btn_edit.gif" alt="Edit">
                </a>
                <a href="/delete-song/{{ song.userid }}/{{ song.songid }}" onclick="return confirm(&#34;Are you sure you want to delete this song?&#34;)" class="song-list-button">
                    <img src="/static/lsp_btn_delete.gif" alt="Delete">
                </a>
                {% endif %}

                <!-- Details Button -->
                <a href="#" onclick="return showDetails(event)" class="song-list-button">
                    <img src="/static/lsp_btn_show.gif" alt="Show Details">
                </a>

                <!-- Play Button -->
                <a href="#" onclick="return play(event)" class="song-list-button">
                    <img src="/static/lsp_btn_play.gif" alt="Play">
                </a>
            </div>
        </div>

        <div class="song-details" hidden>
            <!-- Song Description -->
            {% if song.description %}
            <div class="song-description">{{ song.description }}</div>
            {% endif %}

            <!-- Song Tags -->
            <div class="song-tags">
                Tags:
                {% for tag in song.tags %}
                <a href="/songs?user={{ song.username }}&tag={{ tag }}">{{ tag }}</a>
                {% endfor %}
            </div>
        </div>
    </div>
{% endfor %}
</div>

<script>
function showDetails(event) {
    // Find song-main
    var songElement = event.target;
    while (!songElement.classList.contains("song"))
    {
        songElement = songElement.parentElement;
        console.log(songElement);
    }

    for (const child of songElement.children) {
        if (child.classList.contains("song-details")) {
            if (child.hidden) {
                // Show details
                child.hidden = false;
                event.target.alt = "Hide Details";
                event.target.src = "/static/lsp_btn_hide.gif";
            }
            else {
                // Hide details
                child.hidden = true;
                event.target.alt = "Show Details";
                event.target.src = "/static/lsp_btn_show.gif";
            }
        }
    }
    return false;
}
</script>
